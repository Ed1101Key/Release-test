Name:           release-test
Version:        @VERSION@
Release:        1%{?dist}
Summary:        Small demo service that prints "Alive" every 5 seconds

License:        UNLICENSED
Source0:        %{name}-%{version}.tar.gz

BuildRequires:  gcc-c++
BuildRequires:  make
BuildRequires:  fmt-devel
BuildRequires:  systemd-rpm-macros

Requires:       fmt
Requires(post): systemd
Requires(preun): systemd
Requires(postun): systemd

%description
release-test is a tiny C++ program used for build/release packaging exercises.

%prep
%autosetup -n %{name}-%{version}

%build
%{__cxx} -O2 -g -std=c++17 -Wall -Wextra -Werror -Wno-unused-parameter \
  src/main.cpp -o %{name} -lfmt

%install
rm -rf %{buildroot}

install -D -m 0755 %{name} %{buildroot}%{_bindir}/%{name}
install -D -m 0644 packaging/systemd/%{name}.service %{buildroot}%{_unitdir}/%{name}.service

%post
%systemd_post %{name}.service
if [ $1 -eq 1 ]; then
    /bin/systemctl enable --now %{name}.service >/dev/null 2>&1 || :
else
    /bin/systemctl try-restart %{name}.service >/dev/null 2>&1 || :
fi

%preun
if [ $1 -eq 0 ]; then
    /bin/systemctl disable --now %{name}.service >/dev/null 2>&1 || :
fi
%systemd_preun %{name}.service

%postun
%systemd_postun_with_restart %{name}.service

%files
#%%doc README.md
%{_bindir}/%{name}
%{_unitdir}/%{name}.service

%changelog
* Sat Feb 28 2026 Eduard Basov <ebasov@ispmanager.com> - 1.6-1
- Fix masked service

* Sat Feb 28 2026 Eduard Basov <ebasov@ispmanager.com> - 1.5-1
- Fix start service on deb distr

* Sat Feb 28 2026 Eduard Basov <ebasov@ispmanager.com> - 1.4-1
- Fix start service for RPM-based distr

* Sat Feb 28 2026 Eduard Basov <ebasov@ispmanager.com> - 1.3-1
- Fix typo

* Sat Feb 28 2026 Eduard Basov <ebasov@ispmanager.com> - 1.2-1
- Fix build

* Sat Feb 28 2026 Eduard Basov <ebasov@ispmanager.com> - 1.1-1
- Build improvement

* Sat Feb 28 2026 Eduard Basov <ebasov@ispmanager.com> - 1.0-1
- Init Build For Ispmanager
